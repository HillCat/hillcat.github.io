---
layout: post
title: Linq笔记
categories: DotNetCore
description: Linq笔记整理
keywords: Linq笔记
typora-root-url: ../
---
工作内容的临时备忘，Linq代码片段。

#### 分组筛选统计

```c#
var oneRowCount = (
                    from item in bgeManualMonitorPointDetailEntities
                    group item by
                        new { item.ObjectName }
                    into g
                    select new
                    {
                        Name = g.Key.ObjectName,
                        DropDown = g.Count(x => !string.IsNullOrEmpty(x.DropDown) && x.DropDown != Activated),
                        Temperature = g.Count(x => !string.IsNullOrEmpty(x.Temperature) && x.Temperature != Activated),
                        CrackWidth = g.Count(x => !string.IsNullOrEmpty(x.CrackWidth) && x.CrackWidth != Activated),
                        Distance = g.Count(x => !string.IsNullOrEmpty(x.Distance) && x.Distance != Activated),
                        Reactivity = g.Count(x => !string.IsNullOrEmpty(x.Reactivity) && x.Reactivity != Activated),
                        AngleX = g.Count(x => !string.IsNullOrEmpty(x.AngleX) && x.AngleX != Activated),
                        AngleY = g.Count(x => !string.IsNullOrEmpty(x.AngleY) && x.AngleY != Activated),
                        CableForce = g.Count(x => !string.IsNullOrEmpty(x.CableForce) && x.CableForce != Activated),
                        WindSpeed = g.Count(x => !string.IsNullOrEmpty(x.WindSpeed) && x.WindSpeed != Activated),
                        WindDirection = g.Count(x =>
                            !string.IsNullOrEmpty(x.WindDirection) && x.WindDirection != Activated),
                        Wet = g.Count(x => !string.IsNullOrEmpty(x.Wet) && x.Wet != Activated),
                        Height = g.Count(x => !string.IsNullOrEmpty(x.Height) && x.Height != Activated),
                        Overturn = g.Count(x => !string.IsNullOrEmpty(x.Overturn) && x.Overturn != Activated),
                    }).ToList();
                var outPutListData = new List<ObjectNodeOutPutListDto>();
```



#### Linq分页：

```c#

        public async Task<ReturnPageWithDataDto> GetThirdUnitList(ThirdUnitInputDto inputDto)
        {
            var dataList = await (from p in _instituTionsRepository
                                  join q in _sysAreaRepository
                                  on p.Area_Code equals q.AreaCode
                                  where p.Info_Valid == 0&&p.Inst_Att==6
                                  select new ThirdUnitOutputDto
                                  {
                                      Id = p.Id,
                                      UnitName = p.Inst_Name,
                                      AreaCode = p.Area_Code,
                                      AreaName = q.AreaName,
                                      UnitPhone = p.unit_phone,
                                      ContactName = p.Contact_Name,
                                      ContactNumber = p.Contact_Number,
                                      CreateTime = p.create_time
                                  }).ToListAsync();
            int skip = (inputDto.PageIndex - 1) * inputDto.PageSize;
            dataList = dataList.Skip(skip).Take(inputDto.PageSize).OrderByDescending(o => o.Id).ToList();
            if (!string.IsNullOrEmpty(inputDto.UnitName))
            {
                dataList = dataList.Where(p => p.UnitName.Contains(inputDto.UnitName.Trim())).ToList();
            }
            if (!string.IsNullOrEmpty(inputDto.ContactName))
            {
                dataList = dataList.Where(p => p.ContactName.Contains(inputDto.ContactName.Trim())).ToList();
            }
            return ReturnPageWithDataDto.ToResultSuccess(
                         msg: "获取数据成功",
                         PageIndex: inputDto.PageIndex,
                         PageSize: inputDto.PageSize,
                         TotalRow: dataList == null ? 0 : dataList.Count,
                         modelData: dataList
                         );
        }
```

### 代码中Linq调试

如果是要重构或者是查找bug，使用linqpad贴入代码，然后稍微把一些错误给修复之后，就可以看到执行结果。

![image-20211208192709315](/images/posts/image-20211208192709315.png)

```c#
var loadSource = (from lod in detection_load_tests
                                  join info in bge_infos on lod.Bge_id equals (int)info.Id into lodInfoData
                                  from infod in lodInfoData.DefaultIfEmpty()
                                  join usr in sys_user_details on lod.Upload_user_id equals (int)usr.Id into infoUseData
                                  from infoUse in infoUseData.DefaultIfEmpty()
                                  join ins in institutions on infod.Maintenanceint_Id equals (int)ins.Id into insData
                                  from isd in insData.DefaultIfEmpty()
                                  select new
                                  {
                                      lod.Id,
                                      BridgeId = infod.Id,
									  lod.Type,
									  lod.Time,
									  lod.Det_name,
									  lod.DetInstitiution,
									  lod.Result,
									  lod.Consequence,
									  lod.Auditor,
									  lod.Checker,
									  lod.Report_url,
									  lod.Project_name,
									  lod.Archive_lable,
									  infoUse.UserTrueName,
									  bgeName = infod.Name,
									  infod.Maintenanceint_Id,
									  isd.Inst_name
								  }).OrderByDescending(c => c.Time);
								  loadSource.Dump();
```

![image-20211208192927683](/images/posts/image-20211208192927683.png)

这个Linq里面使用了Left Join，所以导致很多空白的数据被过滤出来。
