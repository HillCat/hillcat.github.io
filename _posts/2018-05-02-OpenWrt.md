---
layout: post
title: OpenWrt固件编译
categories: Blog
description: 台式机windows方案推荐
keywords: trpora
typora-root-url: ../
---
这里先做下备忘录：rs2设备上面有一个lan口，一个wan口，lan口接到路由器的wan口上面，然后r2s的wan口接到光纤猫上面。电脑主机的网线接到路由的lan口上面。总之lan口是消费端。

然后openwrt默认root密码passwd. 通过ip地址ssh进去之后可以修改密码。

openwrt 登录地址：http://192.168.2.1/cgi-bin/luci/admin/network/network

root 默认密码就是上面提到的paddwd， 然后可以修改为自己的密码。







OpenWrt固件编译这个话题的起源：其实对于自己家里番蔷的话，电脑上面同时进行着番蔷动作，而又同时运行着国产的360管家，腾讯系软件，其实这些软件是可以背地里收集用户信息的，它们一定程序上可以干扰或者监控到你win10电脑上面有使用番蔷软件，并且被检测到流量特征之后，会可能上报到国家GWF系统中，导致你的自建番蔷服务器IP被封或者443端口被封的悲剧发生，为了防止安全意外的发生，最好的解决办法是购买一个软路由硬件，自己编译一个OpenWrt固件。刷机到软路由里面。软路由穿墙除了安全之外，还有很多其他的好处。这里只用来记录编译方面的资料和过程，以作为备忘。环境：unbuntu 20.04 Service lite版本，体积1.5G左右，不包括GUI桌面。

### 一定要用更换国内源再安装依赖编译环境

上面安装成功v2raya之后，关闭掉全局部代理，我们先切换到镜像源为华为镜像源，然后安装开发环境依赖之后再切到全局代理开始编译。把/etc/apt/sources.list 备份。

最好还是直接用win10自带的ubuntu编译openwrt是最棒的，前提条件是软路由open clash设置好全局代理：

![image-20220413010231327](/images/posts/image-20220413010231327.png)

![image-20220413010301906](/images/posts/image-20220413010301906.png)

走代理的设备Mac选择好我们的路由器，那么只要是通过路由器上网的所有家庭设备都自动具备了全局穿墙的能力。那么我们ubuntu控制台就可以直接ping通www.google.com了。如果发现ping不通google，证明设置还是有问题的。这里的编译整个过程会经历3~4小时，当然我的电脑是11代i7，编译速度应该可以。

如果没有设置好全局代理的话，系统中进行ubuntu对openwrt编译失败的概率接近100%！！！！应该说是100%失败，我之前查了很多帖子，失败的原因只有一个，那就是linux编译的时候依赖包被蔷了，导致编译失败安装不上编译环境所需要的依赖包。

我这里经过设置之后，就直接开始更新win10自带的ubuntu如下操作，**全程都是代理模式进行**：

更换完之后更新系统：

````c#
sudo apt update
sudo apt dist-upgrade

````

然后安装编译固件所需要的依赖环境：

````c#
sudo apt-get update

sudo apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3.5 python2.7 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf wget swig

````



### 下载lede的openwrt资源

穿墙之后下载速度还能这么快

![image-20220413011355863](/images/posts/image-20220413011355863.png)

```c#
cd lede
```

进入到lede文件夹，添加一些插件的源配置：

然后是一些其他的软件包，编辑 `feeds.conf.default` ，添加

```text
src-git kenzo https://github.com/kenzok8/openwrt-packages
src-git small https://github.com/kenzok8/small
```

上面的依赖环境的安装是在国内镜像源加持下安装完成。之后的操作切换到全局番蔷状态进行更新拉取插件源：

更新插件源，最关键的是要设置全局番蔷代理，v2raya进行如下设置：极其关键的一步！！！！

![78hLM9y2HI](/images/posts/78hLM9y2HI.png)

````c#
./scripts/feeds update -a
./scripts/feeds install -a

````

````c#
make menuconfig
````

进行这个操作的时候，最好是screen开启一个screen进程来处理，防止长时间console控制台掉线。

执行编译出现目录：前面三个菜单分别是选择平台，CPU，芯片组，我这里使用Rockchip的R2S。

![JFSgU78v0z](/images/posts/JFSgU78v0z.png)

![HUgsUwhbHX](/images/posts/HUgsUwhbHX.png)

重点是LuCI里面application的配置安装。

编译完成之后，命令行输入：\\wsl$ 

输入上面的指令就可以直接访问到win10 subsystem ubuntu的根目录。

![6D2DHwDDCf](/images/posts/6D2DHwDDCf.png)

![ubuntu_y2nk3OO2Kv](/images/posts/ubuntu_y2nk3OO2Kv.png)

### 编译教程

文档地址：[https://shimo.im/docs/gYjt9QVr8T9Vhv9X/read](https://shimo.im/docs/gYjt9QVr8T9Vhv9X/read)

插件：[https://www.right.com.cn/forum/thread-344825-1-1.html](https://www.right.com.cn/forum/thread-344825-1-1.html)
